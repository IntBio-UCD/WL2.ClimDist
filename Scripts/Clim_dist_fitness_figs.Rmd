---
title: "Clim_dist_fitness_figs"
author: "Brandie QC"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Code for figures relating climate distance to fitness (Figure 2-4; S4-S7)

## Load libraries
```{r}
library(tidyverse)
library(ggpubr) #ggarrange

sem <- function(x, na.rm=FALSE) {           #for calculating standard error
  sd(x,na.rm=na.rm)/sqrt(length(na.omit(x)))
} 
```

## Read in Data
```{r}
wl2_establishment <- read_csv("../Processed.Data/WL2_Establishment.csv")
wl2_surv_to_bud_y1 <- read_csv("../Processed.Data/WL2_SurvtoRep_y1.csv")
wl2_fruits_y1 <- read_csv("../Processed.Data/WL2_Fruits_Y1.csv")
first_yr_surv <- read_csv("../Processed.Data/WL2_Y1Surv.csv")

winter_surv <- read_csv("../Processed.Data/WL2_WinterSurv.csv")
wl2_surv_to_bud_y2 <- read_csv("../Processed.Data/WL2_Surv_to_Rep_Y2.csv")
wl2_fruits_y2 <- read_csv("../Processed.Data/WL2_Fruits_Y2.csv")

wl2_prob_rep <- read_csv("../Processed.Data/WL2_ProbFit.csv") %>% rename(AvgGD_Recent_Water_Yr=`AvgGD_Recent_Water Year`)
wlt_tot_fitness <- read_csv("../Processed.Data/WL2_TotalRepOutput.csv")
```

## Data Summaries

### Maternal family sample sizes upon transplant (Table S1)
```{r}
wl2_establishment %>% 
  unite(pop.mf, pop:mf, remove = FALSE) %>% 
  group_by(pop.mf) %>% 
  summarise(n=n()) %>% 
  arrange(pop.mf) #number of plants per maternal family 

wl2_establishment %>% 
  select(pop, mf) %>% 
  distinct() %>% 
  group_by(pop) %>% 
  summarise(n=n()) %>% 
  arrange(n) #number of mfs per pop
```

### Fitness Summaries 
```{r}
est_summary <- wl2_establishment %>% 
  group_by(pop, elev_m, Geographic_Dist, GD_Recent_Wtr_Year_2023, GD_Historic_Wtr_Year_2023, 
           TempDist_Recent_Wtr_Year_2023, PPTDist_Recent_Wtr_Year_2023) %>% 
  summarise(meanEst=mean(Establishment, na.rm = TRUE), semEst=sem(Establishment, na.rm=TRUE))

y1surv_summary <- first_yr_surv %>% 
  group_by(pop, elev_m, GD_Recent_GrwSsn_2023, GD_Recent_Wtr_Year_2023, 
           PPTDist_Recent_GrwSsn_2023, TempDist_Recent_Wtr_Year_2023) %>% 
  summarise(meanY1Surv=mean(Y1Survival, na.rm = TRUE), semSurv=sem(Y1Survival, na.rm=TRUE)) 

wintersurv_summary <- winter_surv %>% 
  filter(pop!="WR") %>% #remove pops with too low sample size 
  group_by(pop, elev_m, GD_Recent_Wtr_Year_2024) %>% 
  summarise(meanWintSurv=mean(WinterSurv, na.rm = TRUE), semSurv=sem(WinterSurv, na.rm=TRUE))

wl2_surv_to_bud_y2_summary <- wl2_surv_to_bud_y2 %>% 
  filter(pop != "LV1", pop != "SQ1", pop != "WR") %>% #remove pops with too low sample size 
  group_by(pop, elev_m, Geographic_Dist, GD_Recent_Wtr_Year_2024, 
           TempDist_Recent_Wtr_Year_2024, PPTDist_Recent_Wtr_Year_2024) %>% 
  summarise(meanSurvtoBudY2=mean(SurvtoRep_y2, na.rm = TRUE), semEst=sem(SurvtoRep_y2, na.rm=TRUE)) 

y2_fruits_summary <- wl2_fruits_y2 %>% 
  filter(pop != "LV1", pop != "SQ1", pop != "WR") %>% #remove pops with too low sample size 
  group_by(pop, elev_m, GD_Recent_Wtr_Year_2024) %>% 
  summarise(meanFruitsY2=mean(y2_fruits, na.rm = TRUE), semFruits=sem(y2_fruits, na.rm=TRUE))

prob_fitness_summary <- wl2_prob_rep %>%  
  group_by(pop, elev_m, Geographic_Dist, AvgGD_Recent_Water_Yr, AvgTempDist_Recent_Wtr_Year, 
           AvgPPTDist_Recent_Wtr_Year, AvgPPTDist_Historic_GrwSsn, AvgPPTDist_Recent_GrwSsn) %>% 
  summarise(meanProbFit=mean(ProbFitness, na.rm = TRUE), semEst=sem(ProbFitness, na.rm=TRUE)) %>%
  mutate(RepYear=if_else(meanProbFit==0, "None",
                         if_else(pop=="TM2", "Both Years", "Year 2 Only")))
prob_fitness_summary$RepYear <- factor(prob_fitness_summary$RepYear,
                                               levels = c('None','Year 2 Only', 'Both Years'))

wlt_tot_fitness_summary <- wlt_tot_fitness %>% 
  filter(pop!="SQ1", pop!="WR") %>% 
  group_by(pop, elev_m, AvgTempDist_Historic_GrwSsn, AvgPPTDist_Historic_GrwSsn) %>% 
  summarise(meanTotFruit=mean(Total_Fitness, na.rm=TRUE), semTotFruit=sem(Total_Fitness, na.rm=TRUE))
```

## Figure 2: Temp and PPT recent water climate distance
```{r}
WYtemp_probfit <- prob_fitness_summary %>% 
  ggplot(aes(x=AvgTempDist_Recent_Wtr_Year, y=meanProbFit, group = pop, color=elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(aes(shape=RepYear), size=6) + 
  geom_errorbar(aes(ymin=meanProbFit-semEst,ymax=meanProbFit+semEst),width=.3,linewidth = 2) +
  annotate("text", x = 0.6194583, y= 0.095, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Probability of \n Successfully Reproducing", x="Recent Water Year Temp Dist (°C)", 
       color="Elevation (m)", shape="Rep Year(s)") +
  theme(text=element_text(size=30))
ggsave("../Figures/Indiv_Fit_Comps/ProbFit_TempDist_Recent_WtrYr.png",
       width = 12, height = 6, units = "in")

WYppt_probfit <- prob_fitness_summary %>% 
  ggplot(aes(x=AvgPPTDist_Recent_Wtr_Year, y=meanProbFit, group = pop, color=elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(aes(shape=RepYear), size=6) + 
  geom_errorbar(aes(ymin=meanProbFit-semEst,ymax=meanProbFit+semEst),width=.3,linewidth = 2) +
  annotate("text", x = -555.161, y= 0.095, label = "WL2",
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Probability of \n Successfully Reproducing", x="Recent Water Year PPT Dist (mm)", 
       color="Elevation (m)", shape="Rep Year(s)") +
  theme(text=element_text(size=30))

WYtemp_repsurvy2 <- wl2_surv_to_bud_y2_summary %>% 
  ggplot(aes(x=TempDist_Recent_Wtr_Year_2024, y=meanSurvtoBudY2, group = pop, colour = elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanSurvtoBudY2-semEst,ymax=meanSurvtoBudY2+semEst),width=.3,linewidth = 2) +
  annotate("text", x = 0.4, y= 0.8333333, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0), limits = c(0.4,1.05)) +
  labs(y="Survival to Budding Y2", x="Recent Water Year Temp Dist (°C)", colour = "Elevation (m)") +
  theme(text=element_text(size=30))
ggsave("../Figures/Indiv_Fit_Comps/RepSurv2_TempDist_Recent_WtrYr.png",
       width = 12, height = 6, units = "in")

WYppt_repsurvy2 <- wl2_surv_to_bud_y2_summary %>% 
  ggplot(aes(x=PPTDist_Recent_Wtr_Year_2024, y=meanSurvtoBudY2, group = pop, colour = elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanSurvtoBudY2-semEst,ymax=meanSurvtoBudY2+semEst),width=.3,linewidth = 2) +
  annotate("text", x = 143, y= 0.8333333, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0), limits = c(0.4,1.05)) +
  labs(y="Survival to Budding Y2", x="Recent Water Year PPT Dist (mm)", colour = "Elevation (m)") +
  theme(text=element_text(size=30))

fig4_sub <- ggarrange(WYtemp_probfit, WYtemp_repsurvy2, 
                        WYppt_probfit, WYppt_repsurvy2, 
                        labels = c("A)", "B)", "C)", "D)"), 
                        font.label = list(size=30, face = "plain"), 
                        ncol=2, nrow=2) 
ggsave("../Figures/Figure2_TmpPPT.png", width = 26, height = 18, units = "in")
```

## Figure 3: Gower's recent water year climate distance
```{r}
probfit_gower <- prob_fitness_summary %>% 
  ggplot(aes(x=AvgGD_Recent_Water_Yr, y=meanProbFit, group = pop, color=elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(aes(shape=RepYear), size=6) + 
  geom_errorbar(aes(ymin=meanProbFit-semEst,ymax=meanProbFit+semEst),width=.02,linewidth = 2) +
  annotate("text", x = 0.2532683, y= 0.095, label = "WL2", 	
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Probability of \n Successfully Reproducing", x="Recent Water Year Climate Dist", 
       color="Elevation (m)", shape="Rep Year(s)") +
  theme(text=element_text(size=30))
ggsave("../Figures/Indiv_Fit_Comps/ProbFit_ClimDist_Recent_WtrYr.png",
       width = 12, height = 6, units = "in")

repsurvy2_gower <- wl2_surv_to_bud_y2_summary %>% 
  ggplot(aes(x=GD_Recent_Wtr_Year_2024, y=meanSurvtoBudY2, group = pop, colour = elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanSurvtoBudY2-semEst,ymax=meanSurvtoBudY2+semEst),width=.02,linewidth = 2) +
  annotate("text", x = 0.17, y= 0.8333333, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0), limits = c(0.4,1.05)) +
  labs(y="Survival to Budding Y2", x="Recent Water Year Climate Dist", colour = "Elevation (m)") +
  theme(text=element_text(size=30))
ggsave("../Figures/Indiv_Fit_Comps/RepSurvY2_ClimDist_Recent_WtrYr.png",
       width = 12, height = 6, units = "in")

fig3_gower <- ggarrange(probfit_gower, repsurvy2_gower, 
                        labels = c("A)", "B)"), 
                        font.label = list(size=30, face = "plain"), 
                        ncol=2, nrow=1) 
ggsave("../Figures/Figure3_WtrYrGowers.png", width = 26, height = 9, units = "in")

prob_fitness_summary %>% filter(pop=="WL2")
```

## Figure S4: Additonal Temp and PPT recent water yar climate distance
```{r}
WYtemp_est <- est_summary %>% 
  ggplot(aes(x=TempDist_Recent_Wtr_Year_2023, y=meanEst, group = pop, color=elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanEst-semEst,ymax=meanEst+semEst),width=.3,linewidth = 2) +
  annotate("text", x = 1.635292, y= 0.65, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Establishment", x="Recent Water Year Temp Dist (°C)", color="Elevation (m)") +
  theme(text=element_text(size=30))
ggsave("../Figures/Indiv_Fit_Comps/Est_TempDist_Recent_WtrYr.png",
       width = 12, height = 6, units = "in")

WYppt_est <- est_summary %>% 
  ggplot(aes(x=PPTDist_Recent_Wtr_Year_2023, y=meanEst, group = pop, color=elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanEst-semEst,ymax=meanEst+semEst),width=.3,linewidth = 2) +
  annotate("text", x = -1120, y= 0.5714286, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Establishment", x="Recent Water Year PPT Dist (mm)", color="Elevation (m)") +
  theme(text=element_text(size=30))
ggsave("../Figures/Indiv_Fit_Comps/Est_PPTDist_Recent_WtrYr.png",
       width = 12, height = 6, units = "in")

WYtemp_y1surv <- y1surv_summary %>% 
  ggplot(aes(x=TempDist_Recent_Wtr_Year_2023, y=meanY1Surv, group = pop, colour = elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanY1Surv-semSurv,ymax=meanY1Surv+semSurv),width=.02,linewidth = 2) +
  annotate("text", x = 1.635292, y= 0.88, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Y1 Survival", x="Recent Water Year Temp Dist (°C)", colour="Elevation (m)") +
  theme(text=element_text(size=30))
ggsave("../Figures/Indiv_Fit_Comps/Y1Surv_TempDist_Recent_WtrYr.png",
       width = 12, height = 6, units = "in")

figs4_gower <- ggarrange(WYtemp_est, WYtemp_y1surv, 
                        WYppt_est, 
                        labels = c("A)", "B)", "C)"), 
                        font.label = list(size=30, face = "plain"), 
                        ncol=2, nrow=2) 
ggsave("../Figures/FigureS4_TmpPPT.png", width = 26, height = 18, units = "in")
```

## Figure S5: Growth Season Clim Dist
```{r}
y1surv_ppt <- y1surv_summary %>% 
  ggplot(aes(x=PPTDist_Recent_GrwSsn_2023, y=meanY1Surv, group = pop, color=elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanY1Surv-semSurv,ymax=meanY1Surv+semSurv),width=0.3, linewidth = 2) +
  annotate("text", x = 107.3353	, y= 0.88, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Y1 Survival", x="Recent Growth Season PPT Dist (mm)", colour="Elevation (m)") +
  theme(text=element_text(size=30))

probfit_ppt_recent <- prob_fitness_summary %>% 
  ggplot(aes(x=AvgPPTDist_Recent_GrwSsn, y=meanProbFit, group = pop, color=elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(aes(shape=RepYear), size=6) + 
  geom_errorbar(aes(ymin=meanProbFit-semEst,ymax=meanProbFit+semEst),width=0.3, linewidth = 2) +
  annotate("text", x = 192.3253, y= 0.095, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Probability of \n Successfully Reproducing", x="Recent Growth Season PPT Dist (mm)",
       color="Elevation (m)", shape="Rep Year(s)") +
  theme(text=element_text(size=30))

probfit_ppt_historic <- prob_fitness_summary %>% 
  ggplot(aes(x=AvgPPTDist_Historic_GrwSsn, y=meanProbFit, group = pop, color=elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(aes(shape=RepYear), size=6) + 
  geom_errorbar(aes(ymin=meanProbFit-semEst,ymax=meanProbFit+semEst),width=.3, linewidth = 2) +
  annotate("text", x = 136.0717, y= 0.095, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Probability of \n Successfully Reproducing", x="Historic Growth Season PPT Dist (mm)",
       color="Elevation (m)", shape="Rep Year(s)") +
  theme(text=element_text(size=30))

totrep_temp <- wlt_tot_fitness_summary %>% 
  ggplot(aes(x=AvgTempDist_Historic_GrwSsn, y=meanTotFruit, group = pop, color=elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanTotFruit-semTotFruit,ymax=meanTotFruit+semTotFruit),width=.02, linewidth = 2) +
  annotate("text", x = -1.5, y= 22.40000, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Total Fruit Number", x="Historic Growth Season Temp Dist (°C)", colour="Elevation (m)") +
  theme(text=element_text(size=30))

totrep_ppt <- wlt_tot_fitness_summary %>% 
  ggplot(aes(x=AvgPPTDist_Historic_GrwSsn, y=meanTotFruit, group = pop, color=elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanTotFruit-semTotFruit,ymax=meanTotFruit+semTotFruit),width=.02, linewidth = 2) +
  annotate("text", x = 180, y= 22.40000, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Total Fruit Number", x="Historic Growth Season PPT Dist (mm)", colour="Elevation (m)") +
  theme(text=element_text(size=30))

figs5_gower <- ggarrange(y1surv_ppt, NULL,
                         probfit_ppt_recent, probfit_ppt_historic,
                         totrep_temp, totrep_ppt,
                        labels = c("A)", "", "B)", "", "C)"), 
                        font.label = list(size=30, face = "plain"), 
                        ncol=2, nrow=3) 
ggsave("../Figures/FigureS5_GrwSsn.png", width = 26, height = 27, units = "in")
```

## Figure S6: Additional Gower's recent water year climate distance 
```{r}
est_gower <- est_summary %>% 
  ggplot(aes(x=GD_Recent_Wtr_Year_2023, y=meanEst, group = pop, colour = elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanEst-semEst,ymax=meanEst+semEst),width=.02, linewidth = 2) +
  annotate("text", x = 0.3611659, y= 0.65, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Establishment", x="Recent Water Year Climate Dist", 
       color="Elevation (m)") +
  theme(text=element_text(size=30))

y1surv_gower <- y1surv_summary %>% 
  ggplot(aes(x=GD_Recent_Wtr_Year_2023, y=meanY1Surv, group = pop, colour = elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanY1Surv-semSurv,ymax=meanY1Surv+semSurv),width=.02,linewidth = 2) +
  annotate("text", x = 0.38, y= 0.7884615, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Y1 Survival", x="Recent Water Year Climate Dist", colour="Elevation (m)") +
  theme(text=element_text(size=30))

wintersurv_gower <- wintersurv_summary %>% 
  ggplot(aes(x=GD_Recent_Wtr_Year_2024, y=meanWintSurv, group = pop, colour = elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanWintSurv-semSurv,ymax=meanWintSurv+semSurv),width=.02,linewidth = 2) +
  annotate("text", x = 0.1453708, y= 0.24, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Winter Survival", x="Recent Water Year Climate Dist", colour="Elevation (m)") +
  theme(text=element_text(size=30))
ggsave("../Figures/Indiv_Fit_Comps/WintSurv_ClimDist_Recent_WtrYr.png",
       width = 12, height = 6, units = "in")

figs6_sub <- ggarrange(est_gower, y1surv_gower, 
                        wintersurv_gower, 
                        labels = c("A)", "B)", "C)"), 
                        font.label = list(size=30, face = "plain"), 
                        ncol=2, nrow=2) 
ggsave("../Figures/FigureS6_WTRYRGowers.png", width = 26, height = 18, units = "in")
```

## Figure S7: Geographic Distance
```{r}
est_geo <- est_summary %>% 
  ggplot(aes(x=Geographic_Dist, y=meanEst, group = pop, color=elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanEst-semEst,ymax=meanEst+semEst),width=.02, linewidth = 2) +
  annotate("text", x = 136.2622, y=0.50, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Establishment", x="Geographic Distance (m)", 
       color="Elevation (m)") +
  theme(text=element_text(size=30), axis.text.x = element_text(angle = 45,  hjust = 1))

probfit_geo <- prob_fitness_summary %>% 
  ggplot(aes(x=Geographic_Dist, y=meanProbFit, group = pop, color=elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(aes(shape=RepYear), size=6) + 
  geom_errorbar(aes(ymin=meanProbFit-semEst,ymax=meanProbFit+semEst),width=.2, linewidth = 2) +
  annotate("text", x = 136.2622, y= 0.095, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  labs(y="Probability of \n Successfully Reproducing", x="Geographic Distance (m)", 
       color="Elevation (m)", shape="Rep Year(s)") +
  theme(text=element_text(size=30), axis.text.x = element_text(angle = 45,  hjust = 1))

repsurvy2_geo <- wl2_surv_to_bud_y2_summary %>% 
  ggplot(aes(x=Geographic_Dist, y=meanSurvtoBudY2, group = pop, colour = elev_m)) +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  geom_point(size=6) + 
  geom_errorbar(aes(ymin=meanSurvtoBudY2-semEst,ymax=meanSurvtoBudY2+semEst),width=.2, linewidth = 2) +
  annotate("text", x = 9500, y= 0.8333333, label = "WL2", 
           colour = "purple", fontface="bold", size = 22 / .pt) +
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0), limits = c(0.4,1.05)) +
  labs(y="Survival to Budding Y2", x="Geographic Distance (m)", colour = "Elevation (m)") +
  theme(text=element_text(size=30), axis.text.x = element_text(angle = 45,  hjust = 1))

figS7_geo <- ggarrange(probfit_geo, est_geo, repsurvy2_geo, 
                        labels = c("A)", "B)", "C)"), 
                        font.label = list(size=30, face = "plain"), 
                        ncol=2, nrow=2) 
ggsave("../Figures/FigureS7_Geo.png", width = 26, height = 18, units = "in")
```